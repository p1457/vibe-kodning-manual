# Exempel p친 Home Assistant-automationer
# Kopiera dessa till din automations.yaml eller anv칛nd som inspiration

# =============================================================================
# AUTOMATION 1: T칛nd hall vid d칬rr칬ppning efter solnedg친ng
# =============================================================================
- id: 'hall_light_door_open'
  alias: "T칛nd hall vid d칬rr칬ppning"
  description: "T칛nder hallampan n칛r ytterd칬rren 칬ppnas efter solnedg친ng"
  mode: single
  trigger:
    - platform: state
      entity_id: binary_sensor.ytterdorr
      to: "on"
  condition:
    - condition: sun
      after: sunset
      after_offset: "-00:30:00"  # 30 min innan solnedg친ng
  action:
    - service: light.turn_on
      target:
        entity_id: light.hall
      data:
        brightness_pct: 80
        transition: 2
    # Sl칛ck automatiskt efter 5 minuter om ingen r칬relse
    - delay:
        minutes: 5
    - condition: state
      entity_id: binary_sensor.hall_motion
      state: "off"
      for:
        minutes: 2
    - service: light.turn_off
      target:
        entity_id: light.hall

# =============================================================================
# AUTOMATION 2: Morgonrutin - gradvis uppvakning
# =============================================================================
- id: 'morning_routine'
  alias: "Morgonrutin vardagar"
  description: "Gradvis t칛nd lampor och starta kaffe p친 vardagar"
  mode: single
  trigger:
    - platform: time
      at: "06:30:00"
  condition:
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: "off"
  action:
    # Steg 1: Svagt ljus i sovrummet
    - service: light.turn_on
      target:
        entity_id: light.sovrum
      data:
        brightness_pct: 10
        color_temp: 500  # Varmt ljus
    - delay:
        minutes: 5
    # Steg 2: 칐ka ljus och starta kaffebryggaren
    - service: light.turn_on
      target:
        entity_id: light.sovrum
      data:
        brightness_pct: 50
        color_temp: 400
        transition: 300  # 5 minuters 칬verg친ng
    - service: switch.turn_on
      target:
        entity_id: switch.kaffemaskin
    # Steg 3: Fullt ljus
    - delay:
        minutes: 10
    - service: light.turn_on
      target:
        entity_id: light.sovrum
      data:
        brightness_pct: 100
        color_temp: 300  # Kallare ljus
        transition: 120

# =============================================================================
# AUTOMATION 3: Notifikation n칛r tv칛ttmaskinen 칛r klar
# =============================================================================
- id: 'washing_machine_done'
  alias: "Tv칛ttmaskin klar"
  description: "Skicka notis n칛r tv칛ttmaskinen slutat dra str칬m"
  mode: single
  trigger:
    - platform: numeric_state
      entity_id: sensor.tvattmaskin_power
      below: 5
      for:
        minutes: 2
  condition:
    # Endast om den nyligen dragit mycket str칬m (dvs k칬rde)
    - condition: template
      value_template: >
        {{ states('sensor.tvattmaskin_power') | float < 5 and
           state_attr('sensor.tvattmaskin_power', 'last_above_threshold') is not none }}
  action:
    - service: notify.mobile_app_min_telefon
      data:
        title: "Tv칛tten 칛r klar! 游녯"
        message: "Dags att h칛nga upp tv칛tten"
        data:
          tag: "washing"
          actions:
            - action: "SNOOZE"
              title: "P친minn om 30 min"

# =============================================================================
# AUTOMATION 4: Filml칛ge - dimma lampor n칛r media spelas
# =============================================================================
- id: 'movie_mode'
  alias: "Filml칛ge i vardagsrummet"
  description: "Dimmar lamporna n칛r film startar p친 TV:n"
  mode: restart
  trigger:
    - platform: state
      entity_id: media_player.vardagsrum_tv
      to: "playing"
  condition:
    - condition: time
      after: "18:00:00"
      before: "23:59:59"
  action:
    - service: light.turn_on
      target:
        entity_id: light.vardagsrum
      data:
        brightness_pct: 15
        transition: 3
    # V칛nta tills media pausas eller stoppas
    - wait_for_trigger:
        - platform: state
          entity_id: media_player.vardagsrum_tv
          to:
            - "paused"
            - "idle"
            - "off"
      timeout:
        hours: 4
    # 칀terst칛ll ljus
    - service: light.turn_on
      target:
        entity_id: light.vardagsrum
      data:
        brightness_pct: 70
        transition: 2

# =============================================================================
# AUTOMATION 5: Automatisk l친sning p친 natten
# =============================================================================
- id: 'night_lock'
  alias: "L친s d칬rren p친 natten"
  description: "L친ser ytterd칬rren kl 23:00 om den 칛r ol친st"
  mode: single
  trigger:
    - platform: time
      at: "23:00:00"
  condition:
    - condition: state
      entity_id: lock.ytterdorr
      state: "unlocked"
  action:
    - service: lock.lock
      target:
        entity_id: lock.ytterdorr
    - service: notify.mobile_app_min_telefon
      data:
        title: "D칬rren l친st 游"
        message: "Ytterd칬rren har l친sts automatiskt"
